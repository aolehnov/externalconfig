<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>External Configurator Demo</title>
</head>
<body>
  <h2>External Configurator (Demo)</h2>

  <div id="info"></div>

  <label>Warranty</label>
  <select id="warranty">
    <option value="NONE">NONE</option>
    <option value="2Y">2Y</option>
    <option value="3Y">3Y</option>
  </select>

  <label>Add Charger</label>
  <select id="charger">
    <option value="false">false</option>
    <option value="true">true</option>
  </select>

  <div style="margin-top:18px;">
    <button id="submit">Save & Return to CPQ</button>
  </div>

<script>
  const qs = new URLSearchParams(window.location.search);
  const quoteId = qs.get("quoteId") || "";
  const itemId  = qs.get("itemId")  || "";
  const returnUrl = qs.get("returnUrl") || "";

  document.getElementById("info").innerHTML =
    `quoteId: ${quoteId || "-"}<br/>itemId: ${itemId || "-"}<br/>returnUrl: ${returnUrl || "-"}`;

  const warrantyPrice = { NONE: 0, "2Y": 10, "3Y": 20 };
  const chargerPrice = 25;

  document.getElementById("submit").addEventListener("click", () => {
    const warranty = document.getElementById("warranty").value;
    const addCharger = document.getElementById("charger").value === "true";

    const warrantySurcharge = warrantyPrice[warranty] || 0;
    const chargerSurcharge = addCharger ? chargerPrice : 0;
    const optionsPrice = warrantySurcharge + chargerSurcharge;

    if (!returnUrl) { alert("No returnUrl provided!"); return; }

    const back = new URL(returnUrl);
    back.searchParams.set("quoteId", quoteId);
    back.searchParams.set("itemId", itemId);

    back.searchParams.set("warranty", warranty);
    back.searchParams.set("addCharger", String(addCharger));

    back.searchParams.set("warrantySurcharge", String(warrantySurcharge));
    back.searchParams.set("chargerSurcharge", String(chargerSurcharge));
    back.searchParams.set("optionsPrice", String(optionsPrice));

    window.location.href = back.toString();
  });
</script>
</body>
</html>
